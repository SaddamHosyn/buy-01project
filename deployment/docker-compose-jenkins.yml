# ==============================================================================
# Jenkins CI/CD Server - Docker Compose Configuration
# ==============================================================================


services:
  jenkins-master:
    # Build custom Jenkins image from Dockerfile.jenkins
    # Includes: Docker, Maven, Node.js, Chromium for full CI/CD capability
    build:
      context: .
      dockerfile: Dockerfile.jenkins
    container_name: jenkins-master
    
    # ===========================================================================
    # Security & Permissions
    # ===========================================================================
   
    privileged: true
    user: root
    
    # ===========================================================================
    # Port Mappings
    # ===========================================================================
   
    ports:
      - "8086:8080"
      - "50000:50000"
    
    # ===========================================================================
    # Volume Mounts
    # ===========================================================================
  
    volumes:
      - jenkins_home:/var/jenkins_home
      - /var/run/docker.sock:/var/run/docker.sock
      - ..:/workspace
    
    # Connect to the same network as application services
    networks:
      - buy-01-network
    
    # ===========================================================================
    # Environment Variables
    # ===========================================================================

    environment:
      - DOCKER_HOST=unix:///var/run/docker.sock
      - JAVA_OPTS=-Djenkins.install.runSetupWizard=true

# ==============================================================================
# Named Volumes
# ==============================================================================
volumes:
  jenkins_home:
    external: true
    name: jenkins_home

# ==============================================================================
# Networks
# ==============================================================================

networks:
  buy-01-network:
    external: true
